<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>1ClickWP - Bird Edition</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            bunker: {
              bg: '#0e0e0e',
              panel: '#1a1a1a',
              border: '#2d2d2d',
              text: '#c2f5c2',
              link: '#6fff6f',
              red: '#ff5555'
            }
          },
          fontFamily: {
            mono: ['Courier New', 'monospace']
          }
        }
      }
    };
  </script>
</head>

<body class="bg-bunker-bg text-bunker-text font-mono min-h-screen flex items-center justify-center overflow-hidden">
  <!-- Centered Panel -->
  <div class="w-full max-w-2xl bg-bunker-panel p-6 rounded-xl border border-bunker-border shadow-xl space-y-6">
    <h1 class="text-2xl font-bold border-b border-bunker-border pb-2 text-center">1ClickWP Control</h1>

    <!-- Create Site -->
    <form id="createForm" class="space-y-3">
      <label class="block text-sm">
        Site Name (no spaces)
        <input type="text" id="siteName" required placeholder="my-site"
          class="mt-1 w-full bg-bunker-bg text-white border border-bunker-border px-2 py-1 text-sm rounded" />
      </label>
      <button type="submit"
        class="bg-bunker-link text-black text-sm px-3 py-1 rounded hover:bg-green-400 transition">
        Deploy Site
      </button>
    </form>

    <!-- Site List -->
    <div>
      <h2 class="text-lg font-semibold mb-2 border-b border-bunker-border pb-1">&gt; Active Sites</h2>
      <ul id="siteList" class="space-y-3"></ul>
    </div>

    <!-- About -->
    <div class="mt-6 text-xs space-y-2 border-t border-bunker-border pt-3">
      <p class="text-bunker-link font-semibold">about this cursed project</p>
      <ul class="list-disc pl-5 text-bunker-text space-y-1">
        <li>Single-click WordPress site launcher</li>
        <li>Open source, no SaaS chains</li>
        <li>Built with Docker, Traefik, and dark magic</li>
        <li>Made by a broke dev for other broke devs</li>
      </ul>
      <p class="pt-2 text-bunker-link">
        <a href="https://www.buymeacoffee.com/YOUR_HANDLE" target="_blank" class="underline">☕ Go Pro</a> — support the project and remove distractions.
      </p>
    </div>
  </div>

  <!-- Bigger Bird GIF (Bottom Right Corner) -->
  <div class="fixed bottom-4 right-4 z-50 w-64 opacity-95">
    <div class="tenor-gif-embed" data-postid="3859170581754142147" data-share-method="host" data-aspect-ratio="1.76596" data-width="100%">
      <a href="https://tenor.com/view/bird-mourning-dove-dove-peck-mlem-gif-3859170581754142147">Bird GIF</a> from
      <a href="https://tenor.com/search/bird-gifs">Bird GIFs</a>
    </div>
    <script type="text/javascript" async src="https://tenor.com/embed.js"></script>
  </div>

  <!-- JS Logic -->
  <script>
    async function loadSites() {
      const res = await fetch('/sites');
      const sites = await res.json();
      const list = document.getElementById('siteList');
      list.innerHTML = '';

      if (!sites.length) {
        list.innerHTML = `<p class="text-sm opacity-50">&gt; no sites deployed</p>`;
        return;
      }

      for (const site of sites) {
        const li = document.createElement('li');
        li.className = 'bg-bunker-bg border border-bunker-border p-2 rounded text-sm flex justify-between items-center';
        li.innerHTML = `
          <div>
            <a href="https://${site.domain}" target="_blank" class="font-bold hover:underline text-bunker-link">&gt; ${site.name}</a>
            <p class="text-xs text-gray-400">${site.domain}</p>
          </div>
          <button class="bg-bunker-red text-white px-2 py-1 text-xs rounded hover:bg-red-700"
                  onclick="deleteSite('${site.name}')">Nuke</button>
        `;
        list.appendChild(li);
      }
    }

    async function createSite(e) {
      e.preventDefault();
      const name = document.getElementById('siteName').value.trim();
      if (!name) return;
      const res = await fetch(`/sites?name=${encodeURIComponent(name)}`, { method: 'POST' });
      if (res.ok) {
        document.getElementById('siteName').value = '';
        await loadSites();
      } else {
        const err = await res.json();
        alert(`> Error: ${err.detail}`);
      }
    }

    async function deleteSite(name) {
      if (!confirm(`Nuke this site: ${name}?`)) return;
      const res = await fetch(`/sites/${encodeURIComponent(name)}`, { method: 'DELETE' });
      if (res.ok) {
        await loadSites();
      } else {
        alert("> Failed to delete. It lives.");
      }
    }

    document.getElementById('createForm').addEventListener('submit', createSite);
    loadSites();
  </script>
</body>
</html>
